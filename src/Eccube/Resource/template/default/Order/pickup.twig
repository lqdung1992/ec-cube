{#
 # Created by PhpStorm.
 # User: lqdung1992@gmail.com
 # Date: 3/1/2018
 # Time: 9:42 PM
 #}{% extends 'default_frame.twig' %}
{% set body_class = ' ' %}
{% block stylesheet %}
    <style type="text/css">

        /******************************
            Media Query for tablet, PC...
        *******************************/
        @media only screen and (min-width: 768px) {
            #farmer-status-order-button {
                width: 97% !important;
                margin-bottom: 20px;
            }
        }

        #order_id {
            border-bottom: 2px solid #333333;
            margin-right: 10px;
        }
    </style>
{% endblock stylesheet %}
{% block javascript %}
    {% if is_granted(constant('Eccube\\Entity\\Master\\CustomerRole::FARMER')) or is_granted(constant('Eccube\\Entity\\Master\\CustomerRole::DRIVER')) %}
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBPVy-7CF4XBqC_QPWoRfo-kfI9j9dm_7A&callback=initMap"></script>
    <script>
        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 16,
                center: {lat: -34.397, lng: 150.644}
            });
            var geocoder = new google.maps.Geocoder();
            var address = $('#address').val();
            geocodeAddress(geocoder, map);
        }

        function geocodeAddress(geocoder, resultsMap) {
            var address = document.getElementById('address').value;
            geocoder.geocode({'address': address}, function(results, status) {
                if (status === 'OK') {
                    resultsMap.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                    });
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }
    </script>
    {% endif %}
{% endblock javascript %}
{% block main %}
    {% set Shipping = Order.Shippings[0] %}
    <div id="receiver-status-wrapper" class="wrapper">
        <div class="stepwizard">
            <div class="stepwizard-row">
                {% if is_granted(constant('Eccube\\Entity\\Master\\CustomerRole::RECIPIENT')) %}
                    <div class="stepwizard-step">
                        <span class="circle-symbol">&#x25CF;</span>
                        <p class="color888 title12">出荷登録</p>
                        </div>
                    <div class="stepwizard-step">
                        <span class="circle-symbol color-primary">&#x25CF;</span>
                        <p class="color888 title12 color-primary">配送中</p>
                    </div>
                {% else %}
                    <div class="stepwizard-step">
                        <span class="circle-symbol color-primary">&#x25CF;</span>
                        <p class="color888 title12 color-primary">出荷登録</p>
                    </div>
                    <div class="stepwizard-step">
                        <span class="circle-symbol">&#x25CF;</span>
                        <p class="color888 title12">集荷</p>
                    </div>
                    <div class="stepwizard-step">
                        <span class="circle-symbol">&#x25CF;</span>
                        <p class="title12 color888">配送</p>
                    </div>
                {% endif %}
                <div class="stepwizard-step">
                    <span class="circle-symbol">&#x25CF;</span>
                    <p class="title12">受領確認</p>
                </div>
            </div>
        </div>

        <div id="map-content-wrapper">
            <div id="map-content" class="cart-content">
                {% if is_granted(constant('Eccube\\Entity\\Master\\CustomerRole::RECIPIENT')) %}
                    {#Todo: time#}
                    <div class="title-section-medium">
                        <p>
                            <span class="title20">15時30分</span>
                            <span>に到着予定です</span>
                        </p>
                        <p class="title11 color888">問題なく運行中です</p>
                    </div>
                {% else %}
                <div class="title-section-medium">
                    <p>
                        <span class="title18">
                            {{ Order.receiptable_date|date('m月d日') }} ({{ days[Order.receiptable_date|date('N')] }}) ！
                            {{ busStop.move_time }}
                        </span>
                        <span>までに</span>
                    </p>
                    <p>
                        <span class="title18">{{ busStop.name }}</span>
                        <span>へお持ちください</span>
                    </p>
                    <p class="color888 margin-top15">{{ busStop.address }}</p>
                </div>

                <div class="map">
                    {#Todo: map#}
                    <div id="map"></div>
                    {% if busStop is not null %}
                    <input id="address" type="hidden" value="{{ busStop.address }}">
                    {% endif %}
                    <button class="btn btn-inactive popup" id="farmer-qr-code">QRコードを読み込んで出荷完了する</button>
                    <p class="title12 margin-top10 color888">QRコードは持ち込みの◯時間前から表示できます-15</p>
                </div>
                {% endif %}
            </div>
        </div>

        {% if is_granted(constant('Eccube\\Entity\\Master\\CustomerRole::FARMER')) %}
        <p class="float-right margin-right13"><a class="color888 title11" href="{{ url('contact') }}" target="_blank">商品の出荷が難しい場合</a></p>
        {% endif %}

        <div id="cart-confirm-main">
            <div class="cart-content" id="cart-main-content3">
                <p class="title14 margin-left10 margin-top10 order-title">注文情報</p>
                <div class="receiver-status-profile clearfix">
                    {% if is_granted(constant('Eccube\\Entity\\Master\\CustomerRole::RECIPIENT')) %}
                        <p>生産者</p>
                        <img src="{{ app.config.image_save_urlpath }}/{{ farmer.profile_image|no_image_product }}" class="profile50 img-circle">
                        <span class="profile-name-medium padding-top15">{{ farmer.name01 }}{{ farmer.name02 }}</span>
                    {% else %}
                        <p>お届け先</p>
                        <img src="{{ app.config.image_save_urlpath }}/{{ Order.Customer.profile_image|no_image_product }}" class="profile50 img-circle">
                        <span class="profile-name-medium padding-top15">{{ Order.name01 }}{{ Order.name02 }}</span>
                    {% endif %}
                </div>

                <div class="margin-left10 order-title2">
                    <p class="title12">配達予定日</p>
                    <p class="title18">{{ Order.receiptable_date|date('m月d日') }} ({{ days[Order.receiptable_date|date('N')] }})</p>
                </div>

                <p class="title12 margin-left10 margin-top15">折りたたみコンテナの数</p>
                <div class="margin-left10 clearfix cart-container margin-right10 margin-bottom15 padding-bottom15">
                    <img src="{{ app.config.front_urlpath }}/yasai-bus/img/icon/container-large.svg">
                    <img src="{{ app.config.front_urlpath }}/yasai-bus/img/icon/container-large.svg">
                </div>

                <p class="status-done-th">
                    <span class="title10 margin-right160">品目</span>
                    <span class="title10 margin-left10 margin-right15">点数</span>
                    <span class="title10">価格</span>
                </p>

                {% for orderDetail in Order.OrderDetails %}
                    <div class="receiver-cart-confirm clearfix">
                        <div class="receiver-status-done float-left">
                            <img src="{{ app.config.image_save_urlpath }}/{{ orderDetail.Product.MainListImage|no_image_product }}" class="profile50">
                            <span class="title16 profile-name-medium">{{ orderDetail.product_name }}</span>
                            <span class="profile-address-medium">{{ orderDetail.Product.getAmountFollowPrice02Min }}{{ orderDetail.Product.getAmountUnitTypeFollowPrice02Min.name }}</span>
                        </div>
                        <div class="float-right">
                            <p><span class="margin-right15 border-left-right">{{ orderDetail.quantity|number_format }}</span>{{ calc_inc_tax(orderDetail.price, orderDetail.tax_rate, orderDetail.tax_rule)|price }}</p>
                        </div>
                    </div>
                {% endfor %}
                <p class="title18 margin-left10 margin-top15">注文番号</p>
                <p class="title20 margin-left10 margin-top15" id="order_id">{{ Order.id }}</p>

                {% if is_granted(constant('Eccube\\Entity\\Master\\CustomerRole::RECIPIENT')) %}
                    <div class="float-left margin-left10">
                        <p class="title14">小計</p>
                        <p class="title14">送料</p>
                        <p class="title14">ご請求額</p>
                    </div>
                    <div class="float-right margin-right10">
                        <p class="title14 text-align-right">{{ Order.subtotal|price }}</p>
                        {#Todo: implement container#}
                        <p class="title14 text-align-right">0円</p>
                        <p class="title18 text-align-right">{{ Order.payment_total|price }}</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="x-button hidden" id="qr-code-x-button">&#10060</div>
    <!-- Modal -->
    <div class="modal-select-time clearfix hidden" id="qr-code-dialog">
        <p class="qr-code-p">
            <img src="{{ app.config.front_urlpath }}/yasai-bus/img/qr-code.PNG">
        </p>
        <p class="text-alight-center">
            QRコードをバス停の
            バーコードリーダーにかざすと
            伝票が出力されます
        </p>
    </div>

{% endblock main %}
