{#
 # Created by PhpStorm.
 # User: lqdung1992@gmail.com
 # Date: 02/11/2018
 # Time: 11:00
 #}

{% extends 'default_frame.twig' %}
{% set body_class = ' ' %}
{% block stylesheet %}
    <style type="text/css">
        .comment-image, .comment-image-review {
            border-radius: 5px;
            transition: 0.3s;
        }
        .comment-image:hover, .comment-image-review:hover {opacity: 0.7;}

        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
        }

        /* Modal Content (image) */
        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
        }

        /* Caption of Modal Image */
        #caption {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 10px 0;
            height: 150px;
        }

        /* Add Animation */
        .modal-content, #caption {
            -webkit-animation-name: zoom;
            -webkit-animation-duration: 0.6s;
            animation-name: zoom;
            animation-duration: 0.6s;
        }

        @-webkit-keyframes zoom {
            from {-webkit-transform:scale(0)}
            to {-webkit-transform:scale(1)}
        }

        @keyframes zoom {
            from {transform:scale(0)}
            to {transform:scale(1)}
        }

        /* The Close Button */
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
        }

        .close:hover,
        .close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        /* 100% Image Width on Smaller Screens */
        @media only screen and (max-width: 700px){
            .modal-content {
                width: 100%;
            }
        }
    </style>
{% endblock stylesheet %}

{% block javascript %}
    <script type="text/javascript">
        var modal = document.getElementById('myModal');
        var modalImg = document.getElementById("model-image");

        // preview before post
        var img = document.getElementById('comment-image');
        var captionText = document.getElementById("caption");
        var text = document.getElementById("farm_voice_comment");
        img.onclick = function(){
            modal.style.display = "block";
            modalImg.src = this.src;
            captionText.innerHTML = text.value;
        };
        var span = document.getElementsByClassName("close")[0];
        span.onclick = function() {
            modal.style.display = "none";
        };

        function setImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#comment-image-section').attr('style', 'display:block;');
                    $('#comment-image').attr('src', e.target.result).width(120).height(120);
                };
                reader.readAsDataURL(input.files[0]);
                return true;
            }
        }
        $(function () {
            // review after post
            var img_review = document.getElementsByClassName('comment-image-review');
            $(img_review).each(function(index, item) {
                item.onclick = function() {
                    modal.style.display = "block";
                    modalImg.src = this.src;
                    captionText.innerHTML = '';
                };
            });

            $('.farmer-comment-camera').click(function () {
                $('#farm_voice_file_name').click();
            });

            $('#farm_voice_file_name').change(function () {
                if (!this.value) {
                    return false;
                }
                //restrict upload file type
                var ext = this.value.match(/\.(.+)$/)[1];
                switch (ext) {
                    case 'jpg':
                    case 'jpeg':
                    case 'png':
                    case 'gif':
                        setImage(this);
                        return true;
                        break;
                    default:
                        alert('Only image file type please!!');
                        this.value = '';
                        $('#comment-image-section').hide();
                        return false;
                }

                if ((this.files[0].size)/1024 > '{{ app.config.image_size }}') {
                    alert("Please check upload image not over 1MB");
                    this.value = '';
                    $('#comment-image-section').hide();
                }

                return false;
            });

            $(".exhibition li").click(function () {
                var $class = $(this).data('text');
                $(this).parent().find('li').each(function (index, value) {
                    $(value).removeClass('enable').addClass('disable');
                    $('.'+$(value).data('text')).hide();
                });
                $(this).addClass('enable').removeClass('disable');
                $('.'+$class).show();
            });

            if  ('{{ app.request.query.get('voice') }}') {
                $("ul li#voice").click();
            }
        });
    </script>
{% endblock %}
{% block main %}
    <div class="wrapper" id="service-regist-receiver-wrapper">
        <div class="farmer-new-header">
            <img src="{{ app.config.front_urlpath }}/yasai-bus/img/icon/nav-menu.svg" class="hambuger-menu-reicever">
            <a href="{{ url('top') }}"><img src="{{ app.config.front_urlpath }}/yasai-bus/img/icon/nav-home.svg" class="nav-home"></a>
            <a href="{{ url('top') }}"><img src="{{ app.config.front_urlpath }}/yasai-bus/img/icon/logo.svg" class="logo-svg"></a>
        </div>

        <div id="service-form">
            <div class="farmer-profile">
                {% if TargetCustomer.CustomerImage %}
                    <div id="myCarousel" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            {% for image in TargetCustomer.CustomerImage %}
                                <!-- Wrapper for slides -->
                                <div class="item {% if loop.index == 1 %}active{% endif %}">
                                    <img src="{{ app.config.image_save_urlpath }}/{{ image.file_name }}" alt="Cover" style="width:100%;">
                                </div>
                            {% endfor %}
                        </div>

                        <!-- Left and right controls -->
                        <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                            <span class="glyphicon glyphicon-chevron-left"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" href="#myCarousel" data-slide="next">
                            <span class="glyphicon glyphicon-chevron-right"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                {% else %}
                    <img src="">
                {% endif %}
            </div>

            <div id="receiver-profile" class="clearfix">
                <div class="col-sm-12 col-xs-12">
                    <a href="{{ url('farm_profile_edit') }}"><button class="btn btn-success float-right farmer-follow-btn">編集</button></a>
                    {% set img = app.config.front_urlpath ~ '/yasai-bus/img/camera.PNG' %}
                    {% if TargetCustomer.profile_image %}
                        {% set img = app.config.image_save_urlpath ~'/'~ TargetCustomer.profile_image %}
                    {% endif %}
                    <img id="upload-image" src="{{ img }}" alt="profile" class="img-circle medium-profile">

                    <span class="profile-name-medium color222 title16">{{ TargetCustomer.__toString }}</span>
                    <span class="profile-address-medium">{{ TargetCustomer.Pref.name }}{{ TargetCustomer.addr01 }}{{ TargetCustomer.addr02 }}</span>
                </div>
            </div>
            <div id="farmer-profile-description" class="clearfix">
                <div class="col-sm-12 col-xs-12">
                    {{ TargetCustomer.note|nl2br }}
                </div>
            </div>

            <div class="exhibition">
                <div class="row">
                    <div class="col-sm-12 col-xs-12">
                        <ul class="list-inline">
                            <li id="product" class="list-2item text-alight-center enable" data-text="product-section">出品中</li>
                            <li id="voice" class="list-2item text-alight-center disable" data-text="voice-section">みんなの声</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="product-section row">
                <div class="col-sm-12 col-xs-12">
                    <div class="row">
                        <div class="col-sm-4 col-xs-6">
                            <div class="thumbnail">
                                <img src="{{ app.config.front_urlpath }}/yasai-bus/img/farmer1.PNG" alt="...">
                                <div class="caption">
                                    <h5 class="font-weight mg10">プチぷよトマト</h5>
                                    <h5 class="font-weight mg20">1000円 &nbsp&nbsp&nbsp|&nbsp&nbsp&nbsp 5kg箱</h5>
                                    <p>
                                        <img src="{{ app.config.front_urlpath }}/yasai-bus/img/profile-icon.PNG" alt="profile" class="img-circle small-profile">
                                        <span class="profile-name">高橋農園</span>
                                        <span class="profile-address">静岡県静岡市青青水区</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4 col-xs-6">
                            <div class="thumbnail">
                                <img src="{{ app.config.front_urlpath }}/yasai-bus/img/farmer2.PNG" alt="...">
                                <div class="caption">
                                    <h5 class="font-weight mg10">ヤングコーン</h5>
                                    <h5 class="font-weight mg20">1000円 &nbsp&nbsp&nbsp|&nbsp&nbsp&nbsp 1箱</h5>
                                    <p>
                                        <img src="{{ app.config.front_urlpath }}/yasai-bus/img/profile-icon.PNG" alt="profile" class="img-circle small-profile">
                                        <span class="profile-name">高橋農園</span>
                                        <span class="profile-address">静岡県静岡市青青水区</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4 col-xs-6">
                            <div class="thumbnail">
                                <img src="{{ app.config.front_urlpath }}/yasai-bus/img/farmer1.PNG" alt="...">
                                <div class="caption">
                                    <h5 class="font-weight mg10">プチぷよトマト</h5>
                                    <h5 class="font-weight mg20">1000円 &nbsp&nbsp&nbsp|&nbsp&nbsp&nbsp 1箱</h5>
                                    <p>
                                        <img src="{{ app.config.front_urlpath }}/yasai-bus/img/profile-icon.PNG" alt="profile" class="img-circle small-profile">
                                        <span class="profile-name">高橋農園</span>
                                        <span class="profile-address">静岡県静岡市青青水区</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4 col-xs-6">
                            <div class="thumbnail">
                                <img src="{{ app.config.front_urlpath }}/yasai-bus/img/farmer2.PNG" alt="...">
                                <div class="caption">
                                    <h5 class="font-weight mg10">ヤングコーン</h5>
                                    <h5 class="font-weight mg20">1000円 &nbsp&nbsp&nbsp|&nbsp&nbsp&nbsp 1箱</h5>
                                    <p>
                                        <img src="{{ app.config.front_urlpath }}/yasai-bus/img/profile-icon.PNG" alt="profile" class="img-circle small-profile">
                                        <span class="profile-name">高橋農園</span>
                                        <span class="profile-address">静岡県静岡市青青水区</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="voice-section">
                <div class="voice clearfix">
                    <form method="post" action="?" enctype="multipart/form-data">
                        {{ form_widget(form._token) }}
                        <div class="col-sm-12 col-xs-12 margin-bottom10">
                            {{ form_widget(form.comment, {attr: {placeholder: '投稿されたコメントに答えたり、近況を報告してみましょう！'}}) }}
                            <div class="help">
                                <span class="farmer-comment-text-limit color888">200</span>
                                <img src="{{ app.config.front_urlpath }}/yasai-bus/img/icon/camera.svg" class="farmer-comment-camera">
                            </div>
                            {{ form_widget(form.file_name, {'attr': {'style': 'display: none;'}}) }}
                            {{ form_errors(form.file_name) }}
                        </div>
                        <div id="comment-image-section" class="col-sm-12 col-xs-12 text-alight-center margin-bottom10">
                            <img id="comment-image" class="comment-image" src="">
                        </div>
                        <div class="col-sm-12 col-xs-12">
                            <button type="submit" class="btn btn-inactive">コメントを投稿</button>
                        </div>
                    </form>
                </div>

                {% set other_customer = app.config.front_urlpath ~ '/yasai-bus/img/camera.PNG' %}
                {% for Voice in CustomerVoice %}
                    <div class="div-comment-profile clearfix">
                        <div class="row">
                            <div class="col-sm-12 col-xs-12">
                                {% if Voice.Customer.id == TargetCustomer.id %}
                                    <div class="col-sm-10 col-xs-10">
                                        <div class="comment-description">
                                            <div class="comment">{{ Voice.comment|nl2br }}</div>
                                            {% if Voice.file_name %}
                                                <div class="row">
                                                    <div class="col-sm-12 col-xs-12">
                                                        <img class="comment-image-review" src="{{ app.config.image_save_urlpath }}/{{ Voice.file_name }}">
                                                    </div>
                                                </div>
                                            {% endif %}
                                            <div class="clearfix">
                                                <p class="comment-date float-left">{{ Voice.create_date|date('Y/m/d') }}</p>
                                                {% if is_owner %}
                                                    <p class="float-right"><a class="color888" href="{{ url('farm_profile_voice_delete', {'id': Voice.id}) }}">削除</a></p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 col-xs-2">
                                        <img src="{{ img }}" alt="profile" class="img-circle comment-profile-right">
                                    </div>
                                {% else %}
                                    {% if Voice.Customer.profile_image %}
                                        {% set other_customer = app.config.image_save_urlpath ~ '/' ~ Voice.Customer.profile_image %}
                                    {% endif %}
                                    <div class="col-sm-2 col-xs-2">
                                        <img src="{{ other_customer }}" alt="profile" class="img-circle comment-profile">
                                    </div>
                                    <div class="col-sm-10 col-xs-10">
                                        <div class="comment-description">
                                            <div class="comment">{{ Voice.comment|nl2br }}</div>
                                            {% if Voice.file_name %}
                                                <div class="row">
                                                    <div class="col-sm-12 col-xs-12">
                                                        <img class="comment-image-review" src="{{ app.config.image_save_urlpath }}/{{ Voice.file_name }}">
                                                    </div>
                                                </div>
                                            {% endif %}
                                            <div class="clearfix">
                                                <p class="comment-date float-right margin-bottom10">{{ Voice.create_date|date('Y/m/d') }}</p>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- The Modal -->
    <div id="myModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="model-image"/>
        <div id="caption"></div>
    </div>
{% endblock %}
